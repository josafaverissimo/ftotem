import{B as x,_ as M,f as s,j,o as c,a as p,m as N,b as t,t as S,d as C,n as _,y as O,F,p as P,e as q}from"./index-X3q8PRr_.js";import{_ as H}from"./Spinner-1-QXQBbb.js";import{_ as z}from"./ToastContainer-FFsiBzF9.js";function G(d){const r=new FormData;return r.append("video",d,"message.webm"),x.post("totem-api/clientsMessage/uploadVideo",r,{headers:{"Content-Type":"multipart/form-data"}}).then(n=>n.data)}const k=d=>(P("data-v-e0db6b28"),d=d(),q(),d),A={class:"container"},J=k(()=>t("div",{class:"video"},null,-1)),K={class:"card border"},Q=k(()=>t("span",{class:"h2 title"},"Deixe uma Mensagem",-1)),W={class:"video-wrapper"},X={key:0,class:"timer"},Y={class:"btn-actions-wrapper"},Z={key:0,class:"allowed-record-wrapper"},ee={key:1,class:"not-allowed-record-wrapper"},ae=k(()=>t("p",{class:"not-allowed-record-text"},"Não foi possível acessar a câmera",-1)),te={key:0},oe={__name:"EventShowView",setup(d){let r=null,n=null,l=null;const w=s(!!navigator.mediaDevices),y=s(null),f=s(null),h=s(""),g=s(""),o=s(!1),u=s(!1),v=s(!1),b=s(null),m=s(null),R=j(),T={backgroundImage:`url(${R.backgroundBaseUrl}/${R.currentEvent.background})`};function E(e){r=e}function B(){let e=3;return new Promise(a=>{const i=setInterval(()=>{if(e===0){clearInterval(i),g.value="",a();return}g.value=`${e--}`},1e3)})}function D(){let e=30;const a=setInterval(()=>{if(e===0){V(),h.value="",clearInterval(a);return}h.value=`(${e--})`},1e3);return a}async function L(){if(o.value||v.value)return;try{await navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(E)}catch{w.value=!1;return}l=null,u.value=!1,f.value.src="",o.value=!1,y.value.srcObject=r,await B(),o.value=!0,n=new MediaRecorder(r,{mimeType:"video/webm"});const e=D();n.start();let a=[];n.addEventListener("dataavailable",i=>{a.push(i.data)}),n.addEventListener("stop",i=>{clearInterval(e),h.value="";const I=new Blob(a,{type:"video/webm"});l=I,a=[],f.value.src=URL.createObjectURL(I),u.value=!0})}function V(){o.value=!1,n.stop(),r.getTracks().forEach(e=>e.stop())}async function U(){v.value=!0;try{const{success:e,errors:a}=await G(l);if(e)m.value.pushToast("Mensagem enviada","success"),l=null,u.value=!1,o.value=!1,f.value.src="";else if(a)m.value.pushToast(a.video,"danger");else throw new Error}catch{m.value.pushToast("Houve um erro ao subir o arquivo. Por favor, Contate o administrador.","danger")}finally{v.value=!1}}function $(){if(l=b.value.files[0],l.type.split("/")[0]!=="video"){m.value.pushToast("O arquivo não é um vídeo válido","danger");return}f.value.src=URL.createObjectURL(l),u.value=!0}return(e,a)=>(c(),p(F,null,[N(z,{ref_key:"toastContainer",ref:m},null,512),t("div",{class:"background-image wrapper",style:T},[t("div",A,[J,t("div",K,[Q,t("div",W,[!o.value&&!u.value?(c(),p("span",X,S(g.value),1)):C("",!0),t("video",{class:_(["recording",o.value?"":"d-none"]),ref_key:"videoRecording",ref:y,muted:"",autoplay:""},null,2),o.value?C("",!0):(c(),p("video",{key:1,class:"recorded",ref_key:"videoRecorded",ref:f,controls:""},null,512))]),t("div",Y,[w.value?(c(),p("div",Z,[t("button",{class:_(["btn-record",v.value||o.value?"disabled":""]),onClick:L},"Gravar",2),t("button",{class:_(["btn-stop",o.value?"":"disabled"]),onClick:V},"Parar "+S(h.value),3)])):(c(),p("div",ee,[ae,t("input",{type:"file",name:"chosen-video",capture:"user",accept:"video/*",ref_key:"chosenVideoInput",ref:b,hidden:"",onChange:$},null,544),t("button",{class:_(["choose-video",v.value?"disabled":""]),onClick:a[0]||(a[0]=(...i)=>b.value.click&&b.value.click(...i))}," Selecionar Vídeo do Dispositivo ",2)])),t("button",{class:_(u.value?"":"disabled"),onClick:U},[v.value?(c(),O(H,{key:1,class:"s-1rem"})):(c(),p("span",te,"Enviar"))],2)])])])])],64))}},le=M(oe,[["__scopeId","data-v-e0db6b28"]]);export{le as default};
