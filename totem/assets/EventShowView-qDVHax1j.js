import{B as P,_ as $,f as o,j as M,o as l,a as u,m as x,b as a,t as w,d as D,n as S,y as L,F as U,p as j,e as F}from"./index-2Qcw2tOZ.js";import{_ as N}from"./Spinner-kZdPj_Wj.js";import{_ as q}from"./ToastContainer-NE4b2gkF.js";function H(n){const i=new FormData;return i.append("video",n,"message.webm"),P.post("totem-api/clientsMessage/uploadVideo",i,{headers:{"Content-Type":"multipart/form-data"}}).then(r=>r.data)}const I=n=>(j("data-v-a09e3f52"),n=n(),F(),n),O={class:"container"},z=I(()=>a("div",{class:"video"},null,-1)),G={class:"card border"},A=I(()=>a("span",{class:"h2 title"},"Deixe uma Mensagem",-1)),J={class:"video-wrapper"},K={key:0,class:"timer"},Q={class:"btn-wrapper"},W={key:0},X={__name:"EventShowView",setup(n){let i=null,r=null,d=null;const h=o(null),v=o(null),p=o(""),_=o(""),s=o(!1),c=o(!1),b=o(!1),m=o(null),g=M(),R={backgroundImage:`url(${g.backgroundBaseUrl}/${g.currentEvent.background})`};function V(e){i=e,h.value.srcObject=e,r=new MediaRecorder(e,{mimeType:"video/webm"})}function C(){let e=0;return new Promise(t=>{const f=setInterval(()=>{if(e===3){clearInterval(f),_.value="",t();return}_.value=`${++e}`},1e3)})}function T(){let e=30;const t=setInterval(()=>{if(e===0){y(),p.value="",clearInterval(t);return}p.value=`(${e--})`},1e3);return t}async function B(){if(s.value)return;d=null,c.value=!1,v.value.src="",s.value=!1,await C(),s.value=!0;const e=T();await navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(V);let t=[];r.start(),r.addEventListener("dataavailable",f=>{t.push(f.data)}),r.addEventListener("stop",f=>{clearInterval(e),p.value="";const k=new Blob(t,{type:"video/webm"});d=k,t=[],v.value.src=URL.createObjectURL(k),c.value=!0})}function y(){s.value=!1,r.stop(),i.getTracks().forEach(e=>e.stop())}async function E(){b.value=!0;try{const{success:e}=await H(d);e?(m.value.pushToast("Mensagem enviada","success"),d=null,c.value=!1,s.value=!1,v.value.src=""):m.value.pushToast("Houve um erro ao subir o arquivo. Por favor, Contate o administrador.","danger")}catch{m.value.pushToast("Houve um erro ao subir o arquivo. Por favor, Contate o administrador.","danger")}finally{b.value=!1}}return(e,t)=>(l(),u(U,null,[x(q,{ref_key:"toastContainer",ref:m},null,512),a("div",{class:"background-image wrapper",style:R},[a("div",O,[z,a("div",G,[A,a("div",J,[!s.value&&!c.value?(l(),u("span",K,w(_.value),1)):D("",!0),s.value?(l(),u("video",{key:1,class:"recording",ref_key:"videoPlayer",ref:h,muted:"",autoplay:""},null,512)):(l(),u("video",{key:2,class:"recorded",ref_key:"videoRecorded",ref:v,controls:""},null,512))]),a("div",Q,[a("button",{class:"btn-record",onClick:B},"Gravar"),a("button",{class:S(["btn-stop",s.value?"":"disabled"]),onClick:y},"Parar "+w(p.value),3),a("button",{class:S(c.value?"":"disabled"),onClick:E},[b.value?(l(),L(N,{key:1,class:"s-1rem"})):(l(),u("span",W,"Enviar"))],2)])])])])],64))}},ae=$(X,[["__scopeId","data-v-a09e3f52"]]);export{ae as default};
